<nav class="navbar navbar-expand-lg navbar-dark product-bar fixed-top">
  <button
    class="navbar-toggler"
    type="button"
    data-toggle="collapse"
    data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent"
    aria-expanded="false"
    aria-label="Toggle navigation"
  >
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <% if signed_in? %>
        <% if current_user.admin? %>
          <% add_nav_link_proc text: 'All Sites',
                               path: root_path,
                               nav_icon: 'fa-globe' %>
        <% end %>

        <% if @scope %>
          <% site_obj = model_from_scope :site %>
          <% path_for_site = if current_user.admin?
                               site_obj
                             else
                               root_path
                             end %>
          <% add_nav_link_proc model: site_obj,
                               path: path_for_site,
                               nav_icon: 'fa-institution' %>

          <% cluster_obj = model_from_scope :cluster %>
          <% if cluster_obj %>
            <% add_nav_link_proc model: cluster_obj,
                                 nav_icon: 'fa-server' %>
          <% end %>

          <% component_group_obj = model_from_scope :component_group %>
          <% if component_group_obj %>
            <% add_nav_link_proc model: component_group_obj,
                                 nav_icon: 'fa-cubes' %>
          <% end %>

          <% if @cluster_part %>
            <% add_nav_link_proc model: @cluster_part,
                                 nav_icon: 'fa-cube' %>
          <% end %>
        <% end %>
      <% end %>
      <% nav_link_procs[0..-2].each do |nav_proc| %>
        <%= nav_proc.call %>
      <% end %>
      <%= nav_link_procs.last&.call(active: true) %>
    </ul>

    <% if signed_in? %>
      <% if current_user.admin? %>
        <ul class="navbar-nav justify-content-end">
          <%= render 'partials/nav_link',
                     text: 'Admin Interface',
                     path: rails_admin_path,
                     nav_icon: 'fa-database' %>
        </ul>
      <% end %>

      <span class="navbar-text text-light"><%= current_user.name %></span>
      <%= button_to 'Sign out',
        sign_out_path,
        method: :delete,
        class: ['btn', 'btn-light']
      %>
    <% end %>
  </div>
</nav>

