<% content_for(:subtitle) { "Support Case #{@case.display_id}: #{@case.subject}" } %>

<%= render 'partials/tabs', activate: :cases do %>
  <div class='table-responsive'>
    <table class="table case-table">
      <tr style="width: 100%;">
        <th>Created</th>
        <td>
          <%= @case.created_at.to_formatted_s(:long) %>
          by
          <%= @case.user.name %>
        </td>
        <th>Assigned to</th>
        <td id="case-assignment">
          <%= render 'cases/case_assignment_controls' %>
        </td>
      </tr>
      <tr>
        <th>Association</th>
        <td>
          <%= @case.association_info %>
          <% if current_user.admin? && @case.open? %>
            <%= link_to 'Request maintenance',
                        @case.request_maintenance_path,
                        class: 'btn btn-secondary ml-2 btn-sm',
                        role: 'button'
            %>
          <% end %>
        </td>
        <th>State</th>
        <td id="case-state-controls">
          <%= @case.user_facing_state %>
          <%= render 'cases/case_state_controls' %>
        </td>
      </tr>
      <% if @case.credit_charge %>
      <tr>
        <td colspan="2"></td>
        <th>Credit usage</th>
        <td><%= pluralize(@case.credit_charge, 'credit') %></td>
      </tr>
      <% end %>
      <tr>
        <th>Category</th>
        <td><%= @case.category&.name || 'None' %></td>
        <th>Issue</th>
        <td><%= @case.issue.name %></td>
      </tr>
      <tr>
        <th>Tier</th>
        <td>
          <%= @case.tier_description %>
          <%= render 'cases/escalation_controls' %>
        </td>
        <th>Unique identifier</th>
        <td><%= @case.display_id %></td>
      </tr>
      <%= render 'cases/fields_or_requests_row', kase: @case %>
      <%= render 'cases/time_worked_row' %>
      <tr>
        <th>Case history</th>
        <td colspan="3">
          <%= render 'case_comment_toggle_controls' %>
          <%= render 'case_comments/form' %>
          <% @case.events.each do |event| %>
            <%= event.decorate.event_card %>
          <% end %>
        </td>
      </tr>
    </table>
  </div>
<% end %>
