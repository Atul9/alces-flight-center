<% content_for(:subtitle) { 'Overview' } %>

<%= render 'partials/tabs', activate: :overview do %>
  <div class="card-body row">
    <div class="col-6 card-text">
      <h3><%= site.name %></h3>
      <p><%= site.rendered_description %></p>

      <h4>Primary site contact</h4>
      <ul><li><%= site.primary_contact&.decorate&.info || raw('<em>Unset</em>') %></li></ul>

      <%= site.secondary_contacts_list %>

      <%= site.viewers_list %>

      <% if site.additional_contacts.present? %>

        <h4>Additional site contacts</h4>
        <ul>
          <% site.additional_contacts.each do |contact| %>
            <li><a href="mailto:<%= contact.email %>"><%= contact.email %></a></li>
          <% end %>
        </ul>
      <% end %>
  </div>
    <div class="col">
      <h3>Clusters</h3>
      <div class="list-group cluster-list">
        <% site.clusters.each do |cluster| %>
          <div class="list-group-item">
            <h4><%= cluster.name %></h4>
            <span>
              <%= link_to "Manage this cluster",
                          cluster_path(cluster),
                          class: [
                            'btn',
                            'btn-primary'
                          ]
              %>
              <%= link_to "View cases",
                          cluster_cases_path(cluster),
                          class: [
                            'btn',
                            'btn-primary'
                          ]
              %>

              <%
                  user_can_create_case = policy(Case).create?
                  disabled_class = user_can_create_case ? '' : 'disabled'
                  disabled = !user_can_create_case
                  title = if user_can_create_case
                            nil
                          else
                            "As a #{current_user.role} you cannot create a case"
                          end
              %>
              <%= link_to "Create case",
                          new_cluster_case_path(cluster),
                          class: [
                            'btn',
                            'btn-danger',
                            disabled_class,
                          ],
                          disabled: disabled,
                          title: title
              %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
