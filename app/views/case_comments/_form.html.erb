
<%

  commenting_disabled = current_user.contact? && !@case.consultancy?
  additional_attributes =
    if commenting_disabled
      {
        disabled: true,
        title: <<~TITLE.squish
          This is a non-consultancy support case and so additional discussion is
          not available. If you wish to request additional support please open a
          new support case.
        TITLE
      }
    else
      {}
    end

%>

<% if @case.state == 'open' %>
  <%= form_for [@case, @comment] do |f| %>
    <div class="form-group">
      <%= f.text_area :text,
            class: 'form-control',
            rows: 3,
            **additional_attributes
      %>
    </div>
    <div class="form-group">
      <%= f.submit "Add new comment",
        class: 'btn btn-primary float-right',
        **additional_attributes
      %>
    </div>
  <% end %>
<% end %>
