
<%
  disabled_message_text = <<~TITLE.squish
            This is a non-consultancy support case and so additional discussion is
            not available. If you wish to request additional support please open a
            new support case.
  TITLE
  additional_attributes =
    if @case.commenting_disabled?
      {
        disabled: true,
        title: disabled_message_text
      }
    else
      {}
    end

%>

<% if @case.state == 'open' %>

  <% if @case.commenting_disabled? %>
     <div class="card bg-light">
       <div class="card-body">
         <span class="float-left mr-3">
           <%= icon('info') %>
         </span>
         <%= disabled_message_text %>
       </div>
     </div>
  <% end %>

  <%= form_for [@case, @comment] do |f| %>
    <div class="form-group">
      <%= f.text_area :text,
            class: 'form-control',
            rows: 3,
            **additional_attributes
      %>
    </div>
    <div class="form-group" style="overflow: hidden;">
      <%= f.submit "Add new comment",
        class: 'btn btn-primary float-right',
        **additional_attributes
      %>
    </div>
  <% end %>

<% else %>

  <div class="card bg-light">
     <div class="card-body">
       <span class="float-left mr-3">
         <%= icon('info') %>
       </span>
       Commenting is disabled as this case is <%= @case.state %>.
     </div>
  </div>

<% end %>
