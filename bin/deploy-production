#!/bin/bash
set -euo pipefail
IFS=$'\n\t'


main() {
  local today

  echo; echo
  echo 'Make sure you merge anything you want deployed to master!'
  echo; echo

  git checkout master
  git push origin
  git push production

  ssh ubuntu@apps.alces-flight.com -- 'dokku run flight-center rake db:migrate'
  ssh ubuntu@apps.alces-flight.com -- 'dokku run flight-center rake data:migrate'

  today="$(date -I)"

  git tag production master -f
  git tag "$today" master
  git push --tags -f origin master

  echo; echo
  echo "Don't forget to rename the 'Done' Trello list to '$today'!"
  echo; echo
}

main
