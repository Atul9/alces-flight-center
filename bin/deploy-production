#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

# Not actually tested yet; just a reference for next deployment.

main() {
  git checkout master
  git push origin
  git push production

  ssh ubuntu@apps.alces-flight.com -- 'dokku run flight-center rake db:migrate'
  ssh ubuntu@apps.alces-flight.com -- 'dokku run flight-center rake data:migrate'

  git tag production -f
  git tag "$(date +'%Y-%m-%d')"
  git push --tags -f
}

main
